<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Product Detail</title>
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="styles.css">
  <style>
    .product-detail-container {
      max-width: 700px;
      margin: 40px auto;
      background: #fff;
      border-radius: 16px;
      box-shadow: 0 2px 12px rgba(0,0,0,0.06);
      padding: 32px 24px 24px 24px;
      font-family: 'Roboto', Arial, sans-serif;
    }
    .product-detail-header {
      display: flex;
      gap: 32px;
      align-items: flex-start;
      flex-wrap: wrap;
    }
    .product-detail-header img {
      width: 180px;
      height: 180px;
      object-fit: contain;
      border-radius: 12px;
      background: #f5f5f7;
    }
    .product-detail-info {
      flex: 1;
      min-width: 220px;
    }
    .product-detail-title {
      font-size: 1.5rem;
      font-weight: 700;
      margin-bottom: 8px;
    }
    .product-detail-meta {
      color: #666;
      font-size: 1.05rem;
      margin-bottom: 8px;
    }
    .product-detail-price {
      font-size: 1.25rem;
      color: #007bff;
      font-weight: 700;
      margin-bottom: 12px;
    }
    .product-detail-rating {
      margin-bottom: 12px;
    }
    .product-detail-rating .stars {
      color: #FFD700;
      font-size: 1.2em;
    }
    .reviews-section {
      margin-top: 36px;
    }
    .review {
      background: #fafbfc;
      border-radius: 8px;
      padding: 16px 18px;
      margin-bottom: 18px;
      box-shadow: 0 1px 4px rgba(0,0,0,0.04);
      position: relative;
    }
    .review .reviewer {
      font-weight: 600;
      margin-bottom: 4px;
    }
    .review .review-stars {
      color: #FFD700;
      font-size: 1em;
      margin-right: 6px;
    }
    .back-link {
      display: inline-block;
      margin-bottom: 18px;
      color: #007bff;
      text-decoration: none;
      font-weight: 500;
      transition: color 0.2s;
    }
    .back-link:hover {
      color: #0056b3;
    }
    .product-detail-desc {
      margin-bottom: 14px;
      color: #444;
      font-size: 1.07rem;
      line-height: 1.5;
    }
    .add-review-section {
      margin-top: 36px;
      padding-top: 24px;
      border-top: 1px solid #eee;
    }
    .add-review-section h3 {
      margin-top: 0;
      margin-bottom: 8px;
      font-size: 1.3rem;
    }
    .add-review-section p {
      color: #555;
      font-size: 1.05rem;
      margin-top: 0;
      margin-bottom: 18px;
    }
    .add-review-section .form-group {
      margin-bottom: 18px;
    }
    .add-review-section label {
      display: block;
      font-weight: 600;
      margin-bottom: 8px;
      color: #222;
    }
    .add-review-section textarea {
      width: 100%;
      padding: 12px;
      border: 1px solid #ccc;
      border-radius: 8px;
      font-size: 1rem;
      font-family: 'Roboto', Arial, sans-serif;
      box-sizing: border-box;
      resize: vertical;
      outline: none;
      transition: border-color 0.2s;
    }
    .add-review-section textarea:focus {
      border-color: #007bff;
    }
    .add-review-section button[type="submit"] {
      background: #007bff;
      color: #fff;
      border: none;
      border-radius: 8px;
      padding: 10px 20px;
      font-size: 1.1rem;
      font-weight: 500;
      cursor: pointer;
      transition: background 0.2s;
    }
    .add-review-section button[type="submit"]:hover {
      background: #0056b3;
    }
    .star-rating-input label:before {
      content: '★';
    }
    .star-rating-input {
      direction: rtl;
      display: inline-block;
      font-size: 0;
      position: relative;
      margin-bottom: 8px;
    }
    .star-rating-input input[type="radio"] {
      display: none;
    }
    .star-rating-input label {
      direction: ltr;
      display: inline-block;
      font-size: 1.5rem;
      color: #ccc;
      cursor: pointer;
      padding: 0 2px;
    }

    .star-rating-input input[type="radio"]:checked ~ label {
      color: #FFD700;
    }

    .star-rating-input label:hover,
    .star-rating-input label:hover ~ label {
      color: #ffcc00;
    }

    /* Chat button styles */
    .chat-button {
      background: #28a745;
      color: white;
      border: none;
      border-radius: 8px;
      padding: 10px 20px;
      font-size: 1rem;
      cursor: pointer;
      transition: background 0.2s;
      /* margin-top: 20px; */
      display: flex;
      align-items: center;
      gap: 8px;
    }
    .chat-button:hover {
      background: #218838;
    }
    .chat-button svg {
      width: 20px;
      height: 20px;
      fill: currentColor;
    }

    /* Chat popup styles */
    .chat-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.4);
      backdrop-filter: blur(4px);
      display: none;
      justify-content: center;
      align-items: center;
      z-index: 1000;
      opacity: 0;
      transition: opacity 0.3s ease;
    }
    .chat-overlay.active {
      display: flex;
      opacity: 1;
    }
    .chat-section {
      background: white;
      border-radius: 16px;
      width: 90%;
      max-width: 500px;
      max-height: 80vh;
      display: flex;
      flex-direction: column;
      box-shadow: 0 10px 40px rgba(0, 0, 0, 0.1);
      margin: 20px;
      position: relative;
      transform: translateY(20px);
      transition: transform 0.3s ease;
      overflow: hidden;
    }
    .chat-overlay.active .chat-section {
      transform: translateY(0);
    }
    .chat-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 20px 24px;
      background: #ffffff;
      border-bottom: 1px solid rgba(0, 0, 0, 0.08);
      position: relative;
    }
    .chat-header h3 {
      margin: 0;
      font-size: 1.25rem;
      color: #1a1a1a;
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    .chat-header h3::before {
      content: '';
      display: inline-block;
      width: 8px;
      height: 8px;
      background: #28a745;
      border-radius: 50%;
    }
    .close-chat-btn {
      background: none;
      border: none;
      color: #666;
      cursor: pointer;
      font-size: 1.5rem;
      width: 32px;
      height: 32px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.2s ease;
      line-height: 1;
    }
    .close-chat-btn:hover {
      background: #f5f5f5;
      color: #333;
      transform: rotate(90deg);
    }
    .chat-messages {
      flex: 1;
      overflow-y: auto;
      padding: 24px;
      background: #fafbfc;
      scroll-behavior: smooth;
    }
    .chat-messages::-webkit-scrollbar {
      width: 6px;
    }
    .chat-messages::-webkit-scrollbar-track {
      background: transparent;
    }
    .chat-messages::-webkit-scrollbar-thumb {
      background: #ddd;
      border-radius: 3px;
    }
    .message {
      margin-bottom: 16px;
      max-width: 80%;
      animation: messageSlide 0.3s ease-out;
      position: relative;
    }
    .message.seller {
      margin-right: auto;
      margin-left: 0;
      background: #f0f2f5;
      color: #1a1a1a;
      padding: 12px 16px;
      border-radius: 16px 16px 16px 4px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
    }
    .message.user {
      margin-left: auto;
      margin-right: 0;
      background: #007bff;
      padding: 12px 16px;
      border-radius: 16px 16px 4px 16px;
      box-shadow: 0 2px 8px rgba(0, 123, 255, 0.2);
      color: white;
    }
    .message-input-container {
      padding: 20px 24px;
      background: white;
      border-top: 1px solid rgba(0, 0, 0, 0.08);
      display: flex;
      gap: 12px;
      align-items: center;
    }
    .message-input {
      flex: 1;
      padding: 12px 16px;
      border: 1px solid #e0e0e0;
      border-radius: 24px;
      font-size: 1rem;
      font-family: 'Roboto', Arial, sans-serif;
      transition: all 0.2s ease;
      background: #f8f9fa;
    }
    .message-input:focus {
      outline: none;
      border-color: #007bff;
      background: white;
      box-shadow: 0 0 0 3px rgba(0, 123, 255, 0.1);
    }
    .send-message-btn {
      background: #007bff;
      color: white;
      border: none;
      border-radius: 50%;
      width: 44px;
      height: 44px;
      font-size: 1.2rem;
      cursor: pointer;
      transition: all 0.2s ease;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 0;
    }
    .send-message-btn:hover {
      background: #0056b3;
      transform: scale(1.05);
    }
    .send-message-btn:active {
      transform: scale(0.95);
    }
    @keyframes messageSlide {
      from {
        opacity: 0;
        transform: translateY(10px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
    .add-to-cart-controls {
      margin-top: 20px;
      display: flex;
      gap: 10px;
      align-items: center;
      position: relative;
    }

    .quantity-input {
      width: 60px;
      padding: 8px;
      border: 1px solid #ddd;
      border-radius: 4px;
      text-align: center;
    }

    .error-message {
      color: #dc3545;
      font-size: 0.875rem;
      position: absolute;
      top: 100%;
      left: 0;
      margin-top: 4px;
      display: none;
      white-space: nowrap;
    }

    .error-message.show {
      display: block;
    }

    .rating-error {
      color: #dc3545;
      font-size: 0.875rem;
      margin-top: 4px;
      display: none;
      position: absolute;
      left: 0;
      top: 90%;
      z-index: 1;
    }

    .rating-error.show {
      display: block;
    }

    .form-group {
      position: relative;
      margin-bottom: 20px;
    }

    .delete-review-btn {
      position: absolute;
      top: 10px;
      right: 10px;
      background: none;
      border: none;
      color: #dc3545;
      cursor: pointer;
      padding: 4px 8px;
      opacity: 0.7;
      transition: opacity 0.2s;
      font-size: 14px;
    }

    .review:hover .delete-review-btn {
      opacity: 1;
    }

    .delete-review-btn:hover {
      color: #c82333;
      opacity: 1;
    }

    .review-date {
      color: #666;
      font-size: 0.875rem;
      margin-top: 4px;
    }
  </style>
</head>
<body>
  <nav class="navbar">
    <div class="navbar-left">
      <a href="./index.html" class="site-title">FooBar</a>
    </div>
    <a class="user-profile" href="profile.html">
      <i class="fa-solid fa-user"></i>
    </a>
    <div class="navbar-center">
      <input type="text" placeholder="Search accessories...">
    </div>
    <div class="navbar-right">
      <a href="upload-product.html" class="navbar-link">
        <i class="fa-solid fa-plus"></i>
      </a>
      <a href="cart.html" class="navbar-link">
        Carts 
        <span id="cartCounter" class="cart-counter">0</span>
      </a>
      <a href="orders.html" class="navbar-link">
        Orders
      </a>
      <div class="hamburger" tabindex="0" aria-label="Menu" id="hamburgerBtn">
        <i class="fa-solid fa-bars"></i>
      </div>
    </div>
  </nav>
  <div class="sidebar-overlay" id="sidebarOverlay"></div>
  <aside class="sidebar" id="sidebarMenu">
    <div class="sidebar-header">
      <span>Filter Products</span>
    </div>
    <form id="filterForm">
      <div class="filter-group">
        <label class="filter-label">Category</label>
        <select name="category" id="categorySelect">
          <option value="">All</option>
          <option value="Phone Case">Phone Case</option>
          <option value="Power Bank">Power Bank</option>
          <option value="Charger">Charger</option>
          <option value="Selfie Sticks">Selfie Sticks</option>
          <option value="Bluetooth Speaker">Bluetooth Speaker</option>
          <option value="Screen Protector">Screen Protector</option>
        </select>
      </div>
      <div class="filter-group">
        <label class="filter-label">Condition</label>
        <select name="condition" id="conditionSelect">
          <option value="">All</option>
          <option value="Old">Old</option>
          <option value="New">New</option>
        </select>
      </div>
      <div class="filter-group">
        <label class="filter-label">Price ($)</label>
        <div style="display: flex; gap: 8px; align-items: center;">
          <input type="number" name="minPrice" placeholder="Min" min="0" style="width: 60px;">
          <span>-</span>
          <input type="number" name="maxPrice" placeholder="Max" min="0" style="width: 60px;">
        </div>
      </div>
      <div class="filter-group">
        <label class="filter-label">Star Rating</label>
        <div>
          <label><input type="checkbox" name="star" value="5"> 5 stars</label><br>
          <label><input type="checkbox" name="star" value="4"> 4 stars & up</label><br>
          <label><input type="checkbox" name="star" value="3"> 3 stars & up</label>
        </div>
      </div>
      <button type="button" id="clearFiltersBtn" class="clear-filters">Clear Filters</button>
    </form>
  </aside>
  <div class="product-detail-container" id="productDetail">
    <a href="index.html" class="back-link">&larr; Back to Products</a>
  </div>
  <script>
    const products = JSON.parse(localStorage.getItem('products')) || [];
    
    document.addEventListener('DOMContentLoaded', function() {
      const urlParams = new URLSearchParams(window.location.search);
      const productId = parseInt(urlParams.get('product'));
      const product = products[productId];

      const productDetailContainer = document.getElementById('productDetail');

      if (product) {
        const productHtml = `
          <a href="index.html" class="back-link">&larr; Back to Products</a>
          <div class="product-detail-header">
            <img src="${product.img}" alt="${product.name}">
            <div class="product-detail-info">
              <div class="product-detail-title">${product.name}</div>
              <div class="product-detail-meta">${product.category}</div>
              <div class="product-detail-price">${product.price}</div>
              <div class="product-detail-rating">
                <span class="stars">${'★'.repeat(product.rating)}${'☆'.repeat(5 - product.rating)}</span>
                <span>(${product.reviews} reviews)</span>
              </div>
              <div class="product-detail-desc">${product.description}</div>
              <div class="product-meta" style="margin-top: 10px; text-align: left;">
                 Condition: <span class="condition-badge ${product.condition.toLowerCase()}">${product.condition}</span>
              </div>
            </div>
          </div>
          <div class="add-to-cart-controls">
            <input type="number" class="quantity-input" value="1" min="1">
            <div class="error-message">Please enter a positive number</div>
            <button class="add-to-cart-btn">Add to Cart</button>
            <button class="chat-button" id="openChatBtn">
              <svg viewBox="0 0 24 24">
                <path d="M20 2H4c-1.1 0-2 .9-2 2v18l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm0 14H6l-2 2V4h16v12z"/>
              </svg>
              Chat with Seller
            </button>
          </div>
          <div class="chat-overlay" id="chatOverlay">
            <section class="chat-section" id="chatSection">
              <div class="chat-header">
                <h3>Chat with Seller</h3>
                <button class="close-chat-btn" id="closeChatBtn">&times;</button>
              </div>
              <div class="chat-messages" id="chatMessages">
                <div class="message seller">
                  Hello! I'm the seller. How can I help you with this product?
                </div>
              </div>
              <div class="message-input-container">
                <input type="text" class="message-input" id="messageInput" placeholder="Type your message...">
                <button class="send-message-btn" id="sendMessageBtn">
                  <svg viewBox="0 0 24 24" width="24" height="24" fill="currentColor">
                    <path d="M2.01 21L23 12 2.01 3 2 10l15 2-15 2z"/>
                  </svg>
                </button>
              </div>
            </section>
          </div>
          <section class="add-review-section">
            <h3>Leave a review</h3>
            <form id="reviewForm">
              <div class="form-group">
                <label for="review-rating">Star Rating:</label>
                <div class="star-rating-input">
                  <input type="radio" id="star5" name="rating" value="5"><label for="star5"></label>
                  <input type="radio" id="star4" name="rating" value="4"><label for="star4"></label>
                  <input type="radio" id="star3" name="rating" value="3"><label for="star3"></label>
                  <input type="radio" id="star2" name="rating" value="2"><label for="star2"></label>
                  <input type="radio" id="star1" name="rating" value="1"><label for="star1"></label>
                </div>
                <div class="rating-error">Please select a star rating</div>
              </div>
              <div class="form-group">
                <label for="review-text">Your Review:</label>
                <textarea id="review-text" name="reviewText" rows="4" required></textarea>
              </div>
              <button type="submit">Submit Review</button>
            </form>
          </section>
          <section class="reviews-section">
            <h3>User Reviews</h3>
            <div id="userReviews">
              
            </div>
          </section>
        `;
        productDetailContainer.innerHTML = productHtml;

        // Handle 'Add to Cart' button click
        const addToCartButton = productDetailContainer.querySelector('.add-to-cart-btn');
        if (addToCartButton) {
          addToCartButton.addEventListener('click', function(event) {
            event.preventDefault(); // Prevent default button behavior
            
            const quantityInput = productDetailContainer.querySelector('.quantity-input');
            const errorMessage = productDetailContainer.querySelector('.error-message');
            const quantity = parseInt(quantityInput.value, 10);

            if (isNaN(quantity) || quantity <= 0) {
              errorMessage.classList.add('show');
              return;
            }

            errorMessage.classList.remove('show');
            
            // Get existing cart from localStorage
            let cart = JSON.parse(localStorage.getItem('cart')) || [];
            
            // Check if item already exists in cart
            const existingItemIndex = cart.findIndex(item => item.name === product.name);
            
            if (existingItemIndex !== -1) {
              // Update quantity if item exists
              cart[existingItemIndex].quantity += quantity;
            } else {
              // Add new item if it doesn't exist
              cart.push({
                name: product.name,
                price: product.price,
                img: product.img,
                quantity: quantity
              });
            }
            
            // Save updated cart to localStorage
            localStorage.setItem('cart', JSON.stringify(cart));
            
            // Update cart counter
            const totalItems = cart.reduce((sum, item) => sum + item.quantity, 0);
            const cartCounter = document.getElementById('cartCounter');
            if (cartCounter) {
              cartCounter.textContent = totalItems;
            }
          });
        }

        // Add input validation for quantity
        const quantityInput = productDetailContainer.querySelector('.quantity-input');
        const errorMessage = productDetailContainer.querySelector('.error-message');
        
        quantityInput.addEventListener('input', function() {
          const value = parseInt(this.value, 10);
          if (isNaN(value) || value <= 0) {
            errorMessage.classList.add('show');
          } else {
            errorMessage.classList.remove('show');
          }
        });

        // Initialize cart counter on page load
        const cartCounter = document.getElementById('cartCounter');
        if (cartCounter) {
          const cart = JSON.parse(localStorage.getItem('cart')) || [];
          const totalItems = cart.reduce((sum, item) => sum + item.quantity, 0);
          cartCounter.textContent = totalItems;
        }

        // Display existing reviews
        const reviewsContainer = document.getElementById('userReviews');
        if (product.reviewList && product.reviewList.length > 0) {
          product.reviewList.forEach((review, index) => {
            const reviewElement = `
              <div class="review">
                ${review.reviewer === 'John' ? `
                <button class="delete-review-btn" data-review-index="${index}" title="Delete review">
                  ✕
                </button>
                ` : ''}
                <div class="reviewer">${review.reviewer}</div>
                <div class="review-stars">${'★'.repeat(review.stars)}${'☆'.repeat(5 - review.stars)}</div>
                <div class="review-text">${review.text}</div>
                <div class="review-date">${new Date(review.date).toLocaleDateString()}</div>
              </div>
            `;
            reviewsContainer.innerHTML += reviewElement;
          });
          attachDeleteButtonListeners();
        } else {
          reviewsContainer.innerHTML = '<p>No reviews yet.</p>';
        }

        // Handle review submission
        const reviewForm = document.getElementById('reviewForm');
        const ratingError = document.querySelector('.rating-error');
        
        // Add event listeners to star rating inputs
        const starInputs = document.querySelectorAll('.star-rating-input input[type="radio"]');
        starInputs.forEach(input => {
          input.addEventListener('change', () => {
            if (input.checked) {
              ratingError.classList.remove('show');
            }
          });
        });

        reviewForm.addEventListener('submit', function(event) {
          event.preventDefault();
          const rating = reviewForm.rating.value;
          const reviewText = reviewForm.reviewText.value;
          
          // Validate star rating
          if (!rating) {
            ratingError.classList.add('show');
            return;
          }
          
          ratingError.classList.remove('show');
          
          // Add new review
          const newReview = {
            reviewer: 'John', 
            stars: parseInt(rating),
            text: reviewText,
            date: new Date().toISOString()
          };
          
          // Update product in localStorage
          const products = JSON.parse(localStorage.getItem('products')) || [];
          const urlParams = new URLSearchParams(window.location.search);
          const productIndex = parseInt(urlParams.get('product'));
          console.log(productIndex)
          if (productIndex !== -1) {
            // Initialize reviews array if it doesn't exist
            if (!products[productIndex].reviewList) {
              products[productIndex].reviewList = [];
            }
            
            // Add the new review
            products[productIndex].reviewList.push(newReview);
            
            // Update review count
            products[productIndex].reviews = (products[productIndex].reviews || 0) + 1;
            // Save back to localStorage
            localStorage.setItem('products', JSON.stringify(products));
          }

          // Reset form
          reviewForm.reset();
          
          // Update reviews display
          reviewsContainer.innerHTML = ''; // Clear existing reviews
          products[productIndex].reviewList.forEach((review, reviewIndex) => {
            const reviewElement = `
              <div class="review">
                ${review.reviewer === 'John' ? `
                <button class="delete-review-btn" data-review-index="${reviewIndex}" title="Delete review">
                  ✕
                </button>
                ` : ''}
                <div class="reviewer">${review.reviewer}</div>
                <div class="review-stars">${'★'.repeat(review.stars)}${'☆'.repeat(5 - review.stars)}</div>
                <div class="review-text">${review.text}</div>
                <div class="review-date">${new Date(review.date).toLocaleDateString()}</div>
              </div>
            `;
            reviewsContainer.innerHTML += reviewElement;
          });

          // Update the product rating display
          const ratingDisplay = document.querySelector('.product-detail-rating');
          if (ratingDisplay) {
            ratingDisplay.innerHTML = `
              <span class="stars">★★★★★</span>
              <span>(${products[productIndex].reviewList.length} reviews)</span>
            `;
          }

          // Add delete button event listeners
          attachDeleteButtonListeners();
        });

        // Chat functionality
        const chatOverlay = document.getElementById('chatOverlay');
        const chatSection = document.getElementById('chatSection');
        const openChatBtn = document.getElementById('openChatBtn');
        const closeChatBtn = document.getElementById('closeChatBtn');
        const chatMessages = document.getElementById('chatMessages');
        const messageInput = document.getElementById('messageInput');
        const sendMessageBtn = document.getElementById('sendMessageBtn');

        // Show chat when button is clicked
        openChatBtn.addEventListener('click', () => {
          chatOverlay.classList.add('active');
          document.body.style.overflow = 'hidden'; // Prevent background scrolling
          messageInput.focus();
        });

        // Hide chat when close button is clicked
        closeChatBtn.addEventListener('click', () => {
          chatOverlay.classList.remove('active');
          document.body.style.overflow = ''; // Restore scrolling
        });

        // Close chat when clicking outside
        chatOverlay.addEventListener('click', (e) => {
          if (e.target === chatOverlay) {
            chatOverlay.classList.remove('active');
            document.body.style.overflow = '';
          }
        });

        // Close chat when pressing Escape key
        document.addEventListener('keydown', (e) => {
          if (e.key === 'Escape' && chatOverlay.classList.contains('active')) {
            chatOverlay.classList.remove('active');
            document.body.style.overflow = '';
          }
        });

        function addMessage(text, isUser = false) {
          const messageDiv = document.createElement('div');
          messageDiv.className = `message ${isUser ? 'user' : 'seller'}`;
          messageDiv.textContent = text;
          chatMessages.appendChild(messageDiv);
          chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        function handleSendMessage() {
          const message = messageInput.value.trim();
          if (message) {
            addMessage(message, true);
            messageInput.value = '';
            
            // Simulate seller response after 1 second
            setTimeout(() => {
              const responses = [
                "Thanks for your message! I'll get back to you shortly.",
                "I'm here to help! What would you like to know?",
                "That's a great question! Let me check the details for you.",
                "I'm available to answer any questions about this product."
              ];
              const randomResponse = responses[Math.floor(Math.random() * responses.length)];
              addMessage(randomResponse);
            }, 1000);
          }
        }

        sendMessageBtn.addEventListener('click', handleSendMessage);
        messageInput.addEventListener('keypress', (e) => {
          if (e.key === 'Enter') {
            handleSendMessage();
          }
        });

        // Function to attach delete button listeners
        function attachDeleteButtonListeners() {
          document.querySelectorAll('.delete-review-btn').forEach(btn => {
            btn.addEventListener('click', function() {
              const reviewIndex = parseInt(this.dataset.reviewIndex);
              if (confirm('Are you sure you want to delete this review?')) {
                // Remove review from localStorage
                const products = JSON.parse(localStorage.getItem('products')) || [];
                const urlParams = new URLSearchParams(window.location.search);
                const productIndex = parseInt(urlParams.get('product'));
                
                products[productIndex].reviewList.splice(reviewIndex, 1);
                products[productIndex].reviews = products[productIndex].reviewList.length;
                localStorage.setItem('products', JSON.stringify(products));

                // Update reviews display
                const reviewsContainer = document.getElementById('userReviews');
                reviewsContainer.innerHTML = ''; // Clear existing reviews
                products[productIndex].reviewList.forEach((review, reviewIndex) => {
                  const reviewElement = `
                    <div class="review">
                      ${review.reviewer === 'John' ? `
                      <button class="delete-review-btn" data-review-index="${reviewIndex}" title="Delete review">
                        ✕
                      </button>
                      ` : ''}
                      <div class="reviewer">${review.reviewer}</div>
                      <div class="review-stars">${'★'.repeat(review.stars)}${'☆'.repeat(5 - review.stars)}</div>
                      <div class="review-text">${review.text}</div>
                      <div class="review-date">${new Date(review.date).toLocaleDateString()}</div>
                    </div>
                  `;
                  reviewsContainer.innerHTML += reviewElement;
                });

                // Update the product rating display
                const ratingDisplay = document.querySelector('.product-detail-rating');
                if (ratingDisplay) {
                  ratingDisplay.innerHTML = `
                    <span class="stars">★★★★★</span>
                    <span>(${products[productIndex].reviewList.length} reviews)</span>
                  `;
                }

                // Reattach event listeners to new delete buttons
                attachDeleteButtonListeners();
              }
            });
          });
        }

      } else {
        productDetailContainer.innerHTML = '<p>Product not found.</p>';
      }
    });
  </script>
</body>
</html> 